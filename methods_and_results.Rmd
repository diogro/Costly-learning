---
title: "Methods and results"
output: word_document
---

##Methods
We evaluated the effect of the diet treatment on the choice experiment with a logistic regression, using the diet treatment as a fixed effect. Using this regression, we compared the probability of choosing the rotten cricket between each level of the treatment via a pairwise contrasts in the rms R package. We also estimate the ratio of the odds of choosing the rotten cricket over the odds of choosing the fresh cricket for each diet treatment.


__Referencia do rms:__
Frank E Harrell Jr (2015). rms: Regression Modeling Strategies. R package version 4.3-1.  http://CRAN.R-project.org/package=rms

##Results

__Coloquei o código e o resultado aqui só pra vocês verem, a princípio acho que só precisa da figura.__

```{r}
suppressMessages(library(rms))

data = read.csv("./exp_escolha.csv")

model = lrm(choice ~ treatment, data)
contrast(model, list(treatment = "rotten"), list(treatment = "fresh"))
contrast(model, list(treatment = "rotten"), list(treatment = "dog"))
contrast(model, list(treatment = "fresh"), list(treatment = "dog"))
```

Of all the pair-wise contrasts between the diet treatments, the only significant difference was between the rotten cricket diet and the fresh cricket diet, with the rotten cricket diet being more likely to choose the rotten cricket, and vice-versa. Both cricket diets were not significantly different from the dog food diet. While there was no significant difference between the dog food diet and the cricket diets, we can see in the log odds ratio plot a clear tendency in the cricket treatments to choose which ever cricket the animal had been previously feed, while the dog food group showed no preference.

```{r, echo=FALSE}
library(ggplot2)
suppressMessages(library(cowplot))
library(magrittr)
x = Predict(model, treatment  = levels(data$treatment))
pvalues = data.frame( x = c(2, 2, 3, 3),  y = c(2.8, 2.9, 2.9, 2.8))
ggplot(data.frame(x), aes(treatment, yhat)) +
    geom_pointrange(aes(ymin = lower, ymax = upper)) +
    labs(x = "\nTreatment", y = "Log odds ratio of choosing rotten\n") +
    scale_x_discrete(labels = c("Dog\n food", "Fresh\n cricket", "Rotten\n cricket"), expand = c(0.2, 0)) +
    scale_y_continuous(breaks = -2:2, limit = c(-2.6, 3.3)) +
    geom_hline(yintercept = 0, linetype =  "dotted") +
    geom_path(data = pvalues, aes(x, y)) +
    annotate("text", x = 2.5, y = 3.3, label = "p < 0.01") +
    annotate("text", x = 0.5, y = 2, label = "chooses\nrotten") +
    annotate("text", x = 0.5, y = 0, label = "no\npreference") +
    annotate("text", x = 0.5, y = -2, label = "chooses\nfresh")
```

